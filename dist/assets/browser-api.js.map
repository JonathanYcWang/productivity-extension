{"version":3,"file":"browser-api.js","sources":["../../src/lib/browser-api.ts"],"sourcesContent":["// Unified browser API abstraction for Chrome and Safari compatibility\n// Supports both chrome.* (Chrome) and browser.* (Safari/WebExtensions standard) APIs\n\n// Declare browser global for Safari compatibility\ndeclare const browser: any;\n\n// Detect browser API\nconst browserAPI: any = \n  typeof chrome !== 'undefined' && chrome.runtime \n    ? chrome \n    : typeof browser !== 'undefined' && (browser as any).runtime\n    ? browser\n    : null;\n\n// Helper to convert Chrome-style callbacks to Promises for Safari compatibility\nfunction promisify<T = any>(fn: (...args: any[]) => any): (...args: any[]) => Promise<T> {\n  return (...args: any[]) => {\n    return new Promise((resolve, reject) => {\n      try {\n        // Remove callback from args if present\n        const callback = args[args.length - 1];\n        if (typeof callback === 'function') {\n          args.pop();\n        }\n        \n        // Chrome APIs may return a Promise or use callbacks\n        if (fn.length === args.length + 1) {\n          // Function expects a callback\n          fn(...args, (result: T) => {\n            if (browserAPI?.runtime?.lastError) {\n              reject(new Error(browserAPI.runtime.lastError.message));\n            } else {\n              resolve(result);\n            }\n          });\n        } else {\n          // Function may return a Promise directly\n          const result = fn(...args);\n          if (result && typeof (result as any).then === 'function') {\n            (result as Promise<T>).then(resolve).catch(reject);\n          } else {\n            resolve(result as T);\n          }\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  };\n}\n\n// Storage API\nexport const storage = {\n  sync: {\n    get: (keys: string | string[] | Record<string, any> | null): Promise<Record<string, any>> => {\n      if (!browserAPI?.storage?.sync) {\n        return Promise.resolve({});\n      }\n      return new Promise((resolve, reject) => {\n        browserAPI.storage.sync.get(keys, (result: Record<string, any>) => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve(result || {});\n          }\n        });\n      });\n    },\n    set: (items: Record<string, any>): Promise<void> => {\n      if (!browserAPI?.storage?.sync) {\n        return Promise.resolve();\n      }\n      return new Promise((resolve, reject) => {\n        browserAPI.storage.sync.set(items, () => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve();\n          }\n        });\n      });\n    },\n    remove: (keys: string | string[]): Promise<void> => {\n      if (!browserAPI?.storage?.sync) {\n        return Promise.resolve();\n      }\n      return new Promise((resolve, reject) => {\n        browserAPI.storage.sync.remove(keys, () => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve();\n          }\n        });\n      });\n    }\n  },\n  local: {\n    get: (keys: string | string[] | Record<string, any> | null): Promise<Record<string, any>> => {\n      if (!browserAPI?.storage?.local) {\n        return Promise.resolve({});\n      }\n      return new Promise((resolve, reject) => {\n        browserAPI.storage.local.get(keys, (result: Record<string, any>) => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve(result || {});\n          }\n        });\n      });\n    },\n    set: (items: Record<string, any>): Promise<void> => {\n      if (!browserAPI?.storage?.local) {\n        return Promise.resolve();\n      }\n      return new Promise((resolve, reject) => {\n        browserAPI.storage.local.set(items, () => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve();\n          }\n        });\n      });\n    },\n    remove: (keys: string | string[]): Promise<void> => {\n      if (!browserAPI?.storage?.local) {\n        return Promise.resolve();\n      }\n      return new Promise((resolve, reject) => {\n        browserAPI.storage.local.remove(keys, () => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve();\n          }\n        });\n      });\n    }\n  },\n  onChanged: browserAPI?.storage?.onChanged\n};\n\n// Alarms API with fallback for Safari\nlet alarmFallbackInterval: number | null = null;\nconst alarmStorageKey = 'alarm_fallbacks';\nconst alarmCallbacks: Array<(alarm: chrome.alarms.Alarm) => void> = [];\n\n// Initialize alarm fallback checker if alarms API is not available\nfunction initAlarmFallback() {\n  if (browserAPI?.alarms) return; // Alarms API is available\n  \n  if (alarmFallbackInterval !== null) return; // Already initialized\n  \n  // Check for expired alarms every minute (setInterval is available in service workers)\n  alarmFallbackInterval = setInterval(async () => {\n    try {\n      const { [alarmStorageKey]: alarms } = await storage.local.get(alarmStorageKey);\n      if (!alarms || !Array.isArray(alarms)) return;\n      \n      const now = Date.now();\n      const remaining = alarms.filter((alarm: { name: string; when: number }) => alarm.when > now);\n      \n      // Trigger expired alarms\n      const expired = alarms.filter((alarm: { name: string; when: number }) => alarm.when <= now);\n      for (const alarm of expired) {\n        // Call registered alarm callbacks directly (works in both window and service worker contexts)\n        const alarmObj = { name: alarm.name, scheduledTime: alarm.when } as chrome.alarms.Alarm;\n        alarmCallbacks.forEach(callback => {\n          try {\n            callback(alarmObj);\n          } catch (error) {\n            console.error('Error in alarm callback:', error);\n          }\n        });\n      }\n      \n      // Update stored alarms\n      if (remaining.length !== alarms.length) {\n        if (remaining.length === 0) {\n          await storage.local.remove(alarmStorageKey);\n        } else {\n          await storage.local.set({ [alarmStorageKey]: remaining });\n        }\n      }\n    } catch (error) {\n      console.error('Error in alarm fallback:', error);\n    }\n  }, 60000);\n}\n\nexport const alarms = {\n  create: (name: string, alarmInfo: chrome.alarms.AlarmCreateInfo | any): Promise<void> => {\n    if (browserAPI?.alarms?.create) {\n      return new Promise((resolve, reject) => {\n        browserAPI.alarms.create(name, alarmInfo, () => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve();\n          }\n        });\n      });\n    }\n    \n    // Fallback for Safari: store alarm info and check periodically\n    initAlarmFallback();\n    return storage.local.get(alarmStorageKey).then((data) => {\n      const existing = (data[alarmStorageKey] || []) as Array<{ name: string; when: number }>;\n      const filtered = existing.filter(a => a.name !== name);\n      const when = alarmInfo.when || (alarmInfo.delayInMinutes ? Date.now() + alarmInfo.delayInMinutes * 60000 : \n                                      alarmInfo.periodInMinutes ? Date.now() + alarmInfo.periodInMinutes * 60000 : Date.now());\n      filtered.push({ name, when });\n      return storage.local.set({ [alarmStorageKey]: filtered });\n    });\n  },\n  clear: (name?: string): Promise<boolean> => {\n    if (browserAPI?.alarms?.clear) {\n      return new Promise((resolve, reject) => {\n        browserAPI.alarms.clear(name, (wasCleared: boolean) => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve(wasCleared);\n          }\n        });\n      });\n    }\n    \n    // Fallback: remove from stored alarms\n    if (name) {\n      return storage.local.get(alarmStorageKey).then((data) => {\n        const existing = (data[alarmStorageKey] || []) as Array<{ name: string; when: number }>;\n        const filtered = existing.filter(a => a.name !== name);\n        if (filtered.length === 0) {\n          return storage.local.remove(alarmStorageKey).then(() => true);\n        }\n        return storage.local.set({ [alarmStorageKey]: filtered }).then(() => true);\n      });\n    }\n    return Promise.resolve(true);\n  },\n  getAll: (): Promise<Array<chrome.alarms.Alarm | any>> => {\n    if (browserAPI?.alarms?.getAll) {\n      return new Promise((resolve, reject) => {\n        browserAPI.alarms.getAll((alarms: any[]) => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve(alarms || []);\n          }\n        });\n      });\n    }\n    \n    // Fallback: return stored alarms\n    return storage.local.get(alarmStorageKey).then((data: any) => {\n      const alarmsList = (data[alarmStorageKey] || []) as Array<{ name: string; when: number }>;\n      return alarmsList.map(a => ({ name: a.name, scheduledTime: a.when })) as Array<chrome.alarms.Alarm>;\n    });\n  },\n  onAlarm: browserAPI?.alarms?.onAlarm || {\n    addListener: (callback: (alarm: chrome.alarms.Alarm) => void) => {\n      // Fallback: register callback to be called when alarms fire\n      alarmCallbacks.push(callback);\n      // Also initialize fallback if not already done\n      initAlarmFallback();\n    }\n  }\n};\n\n// Tabs API\nexport const tabs = {\n  query: (queryInfo: chrome.tabs.QueryInfo | any): Promise<Array<chrome.tabs.Tab | any>> => {\n    if (!browserAPI?.tabs?.query) {\n      return Promise.resolve([]);\n    }\n    return new Promise((resolve, reject) => {\n      browserAPI.tabs.query(queryInfo, (tabs: any) => {\n        if (browserAPI.runtime?.lastError) {\n          reject(new Error(browserAPI.runtime.lastError.message));\n        } else {\n          resolve(tabs || []);\n        }\n      });\n    });\n  },\n  remove: (tabIds: number | number[]): Promise<void> => {\n    if (!browserAPI?.tabs?.remove) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      browserAPI.tabs.remove(tabIds, () => {\n        if (browserAPI.runtime?.lastError) {\n          reject(new Error(browserAPI.runtime.lastError.message));\n        } else {\n          resolve();\n        }\n      });\n    });\n  },\n  sendMessage: (tabId: number, message: any, options?: chrome.tabs.MessageSendOptions): Promise<any> => {\n    if (!browserAPI?.tabs?.sendMessage) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      browserAPI.tabs.sendMessage(tabId, message, options || {}, (response: any) => {\n        if (browserAPI.runtime?.lastError) {\n          reject(new Error(browserAPI.runtime.lastError.message));\n        } else {\n          resolve(response);\n        }\n      });\n    });\n  },\n  onUpdated: browserAPI?.tabs?.onUpdated\n};\n\n// Runtime API\nexport const runtime = {\n  sendMessage: (message: any): Promise<any> => {\n    if (!browserAPI?.runtime?.sendMessage) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      browserAPI.runtime.sendMessage(message, (response: any) => {\n        if (browserAPI.runtime?.lastError) {\n          // Ignore errors if no listener is registered (common in Safari)\n          if (browserAPI.runtime.lastError.message?.includes('Could not establish connection')) {\n            resolve(null);\n          } else {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          }\n        } else {\n          resolve(response);\n        }\n      });\n    });\n  },\n  onMessage: browserAPI?.runtime?.onMessage,\n  onInstalled: browserAPI?.runtime?.onInstalled,\n  onStartup: browserAPI?.runtime?.onStartup,\n  openOptionsPage: (): Promise<void> => {\n    if (!browserAPI?.runtime?.openOptionsPage) {\n      // Fallback: open options page manually\n      if (typeof window !== 'undefined') {\n        window.open(browserAPI?.runtime?.getURL?.('options/index.html') || 'options/index.html', '_blank');\n      }\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      browserAPI.runtime.openOptionsPage(() => {\n        if (browserAPI.runtime?.lastError) {\n          reject(new Error(browserAPI.runtime.lastError.message));\n        } else {\n          resolve();\n        }\n      });\n    });\n  },\n  getURL: (path: string): string => {\n    if (!browserAPI?.runtime?.getURL) {\n      return path;\n    }\n    return browserAPI.runtime.getURL(path);\n  }\n};\n\n// Scripting API (for content script injection)\nexport const scripting = {\n  executeScript: (details: any): Promise<Array<chrome.scripting.InjectionResult | any>> => {\n    if (browserAPI?.scripting?.executeScript) {\n      // Chrome MV3 / Safari with scripting API\n      return new Promise((resolve, reject) => {\n        (browserAPI.scripting.executeScript as any)(details, (results: any[]) => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve(results || []);\n          }\n        });\n      });\n    }\n    \n    // Fallback: Safari may use tabs.executeScript (deprecated but may work)\n    if ((browserAPI?.tabs as any)?.executeScript) {\n      return new Promise((resolve, reject) => {\n        (browserAPI.tabs as any).executeScript(details.target?.tabId, details.files ? { file: details.files[0] } : details, (results: any) => {\n          if (browserAPI.runtime?.lastError) {\n            reject(new Error(browserAPI.runtime.lastError.message));\n          } else {\n            resolve(results || []);\n          }\n        });\n      });\n    }\n    \n    console.warn('Scripting API not available, content script injection may not work');\n    return Promise.resolve([]);\n  }\n};\n\n// Action API (Chrome MV3) / BrowserAction API (Chrome MV2/Safari)\nexport const action = {\n  onClicked: browserAPI?.action?.onClicked || (browserAPI as any)?.browserAction?.onClicked || null,\n  // Direct access for fallback\n  _raw: browserAPI?.action || (browserAPI as any)?.browserAction || null\n};\n\n// Initialize alarm fallback if needed (for background/service worker context)\nif (typeof window === 'undefined' || typeof chrome !== 'undefined' || typeof browser !== 'undefined') {\n  initAlarmFallback();\n}\n\n"],"names":["browserAPI","_a","storage","keys","resolve","reject","result","items","alarmFallbackInterval","alarmStorageKey","alarmCallbacks","initAlarmFallback","alarms","now","remaining","alarm","expired","alarmObj","callback","error","name","alarmInfo","data","filtered","a","when","wasCleared","tabs","queryInfo","tabIds","tabId","message","options","response","_b","_c","runtime","path","scripting","details","results","action"],"mappings":"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"}