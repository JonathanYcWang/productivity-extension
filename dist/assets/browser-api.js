const e=typeof chrome<"u"&&chrome.runtime?chrome:typeof browser<"u"&&browser.runtime?browser:null;var f;const u={sync:{get:t=>{var r;return(r=e==null?void 0:e.storage)!=null&&r.sync?new Promise((s,a)=>{e.storage.sync.get(t,n=>{var i;(i=e.runtime)!=null&&i.lastError?a(new Error(e.runtime.lastError.message)):s(n||{})})}):Promise.resolve({})},set:t=>{var r;return(r=e==null?void 0:e.storage)!=null&&r.sync?new Promise((s,a)=>{e.storage.sync.set(t,()=>{var n;(n=e.runtime)!=null&&n.lastError?a(new Error(e.runtime.lastError.message)):s()})}):Promise.resolve()},remove:t=>{var r;return(r=e==null?void 0:e.storage)!=null&&r.sync?new Promise((s,a)=>{e.storage.sync.remove(t,()=>{var n;(n=e.runtime)!=null&&n.lastError?a(new Error(e.runtime.lastError.message)):s()})}):Promise.resolve()}},local:{get:t=>{var r;return(r=e==null?void 0:e.storage)!=null&&r.local?new Promise((s,a)=>{e.storage.local.get(t,n=>{var i;(i=e.runtime)!=null&&i.lastError?a(new Error(e.runtime.lastError.message)):s(n||{})})}):Promise.resolve({})},set:t=>{var r;return(r=e==null?void 0:e.storage)!=null&&r.local?new Promise((s,a)=>{e.storage.local.set(t,()=>{var n;(n=e.runtime)!=null&&n.lastError?a(new Error(e.runtime.lastError.message)):s()})}):Promise.resolve()},remove:t=>{var r;return(r=e==null?void 0:e.storage)!=null&&r.local?new Promise((s,a)=>{e.storage.local.remove(t,()=>{var n;(n=e.runtime)!=null&&n.lastError?a(new Error(e.runtime.lastError.message)):s()})}):Promise.resolve()}},onChanged:(f=e==null?void 0:e.storage)==null?void 0:f.onChanged};let g=null;const o="alarm_fallbacks",M=[];function c(){e!=null&&e.alarms||g===null&&(g=setInterval(async()=>{try{const{[o]:t}=await u.local.get(o);if(!t||!Array.isArray(t))return;const r=Date.now(),s=t.filter(n=>n.when>r),a=t.filter(n=>n.when<=r);for(const n of a){const i={name:n.name,scheduledTime:n.when};M.forEach(l=>{try{l(i)}catch(m){console.error("Error in alarm callback:",m)}})}s.length!==t.length&&(s.length===0?await u.local.remove(o):await u.local.set({[o]:s}))}catch(t){console.error("Error in alarm fallback:",t)}},6e4))}var E;const k={create:(t,r)=>{var s;return(s=e==null?void 0:e.alarms)!=null&&s.create?new Promise((a,n)=>{e.alarms.create(t,r,()=>{var i;(i=e.runtime)!=null&&i.lastError?n(new Error(e.runtime.lastError.message)):a()})}):(c(),u.local.get(o).then(a=>{const i=(a[o]||[]).filter(m=>m.name!==t),l=r.when||(r.delayInMinutes?Date.now()+r.delayInMinutes*6e4:r.periodInMinutes?Date.now()+r.periodInMinutes*6e4:Date.now());return i.push({name:t,when:l}),u.local.set({[o]:i})}))},clear:t=>{var r;return(r=e==null?void 0:e.alarms)!=null&&r.clear?new Promise((s,a)=>{e.alarms.clear(t,n=>{var i;(i=e.runtime)!=null&&i.lastError?a(new Error(e.runtime.lastError.message)):s(n)})}):t?u.local.get(o).then(s=>{const n=(s[o]||[]).filter(i=>i.name!==t);return n.length===0?u.local.remove(o).then(()=>!0):u.local.set({[o]:n}).then(()=>!0)}):Promise.resolve(!0)},getAll:()=>{var t;return(t=e==null?void 0:e.alarms)!=null&&t.getAll?new Promise((r,s)=>{e.alarms.getAll(a=>{var n;(n=e.runtime)!=null&&n.lastError?s(new Error(e.runtime.lastError.message)):r(a||[])})}):u.local.get(o).then(r=>(r[o]||[]).map(a=>({name:a.name,scheduledTime:a.when})))},onAlarm:((E=e==null?void 0:e.alarms)==null?void 0:E.onAlarm)||{addListener:t=>{M.push(t),c()}}};var d;const S={query:t=>{var r;return(r=e==null?void 0:e.tabs)!=null&&r.query?new Promise((s,a)=>{e.tabs.query(t,n=>{var i;(i=e.runtime)!=null&&i.lastError?a(new Error(e.runtime.lastError.message)):s(n||[])})}):Promise.resolve([])},remove:t=>{var r;return(r=e==null?void 0:e.tabs)!=null&&r.remove?new Promise((s,a)=>{e.tabs.remove(t,()=>{var n;(n=e.runtime)!=null&&n.lastError?a(new Error(e.runtime.lastError.message)):s()})}):Promise.resolve()},sendMessage:(t,r,s)=>{var a;return(a=e==null?void 0:e.tabs)!=null&&a.sendMessage?new Promise((n,i)=>{e.tabs.sendMessage(t,r,s||{},l=>{var m;(m=e.runtime)!=null&&m.lastError?i(new Error(e.runtime.lastError.message)):n(l)})}):Promise.resolve()},onUpdated:(d=e==null?void 0:e.tabs)==null?void 0:d.onUpdated};var p,h,y;const C={sendMessage:t=>{var r;return(r=e==null?void 0:e.runtime)!=null&&r.sendMessage?new Promise((s,a)=>{e.runtime.sendMessage(t,n=>{var i,l;(i=e.runtime)!=null&&i.lastError?(l=e.runtime.lastError.message)!=null&&l.includes("Could not establish connection")?s(null):a(new Error(e.runtime.lastError.message)):s(n)})}):Promise.resolve()},onMessage:(p=e==null?void 0:e.runtime)==null?void 0:p.onMessage,onInstalled:(h=e==null?void 0:e.runtime)==null?void 0:h.onInstalled,onStartup:(y=e==null?void 0:e.runtime)==null?void 0:y.onStartup,openOptionsPage:()=>{var t,r,s;return(t=e==null?void 0:e.runtime)!=null&&t.openOptionsPage?new Promise((a,n)=>{e.runtime.openOptionsPage(()=>{var i;(i=e.runtime)!=null&&i.lastError?n(new Error(e.runtime.lastError.message)):a()})}):(typeof window<"u"&&window.open(((s=(r=e==null?void 0:e.runtime)==null?void 0:r.getURL)==null?void 0:s.call(r,"options/index.html"))||"options/index.html","_blank"),Promise.resolve())},getURL:t=>{var r;return(r=e==null?void 0:e.runtime)!=null&&r.getURL?e.runtime.getURL(t):t}},L={executeScript:t=>{var r,s;return(r=e==null?void 0:e.scripting)!=null&&r.executeScript?new Promise((a,n)=>{e.scripting.executeScript(t,i=>{var l;(l=e.runtime)!=null&&l.lastError?n(new Error(e.runtime.lastError.message)):a(i||[])})}):(s=e==null?void 0:e.tabs)!=null&&s.executeScript?new Promise((a,n)=>{var i;e.tabs.executeScript((i=t.target)==null?void 0:i.tabId,t.files?{file:t.files[0]}:t,l=>{var m;(m=e.runtime)!=null&&m.lastError?n(new Error(e.runtime.lastError.message)):a(l||[])})}):(console.warn("Scripting API not available, content script injection may not work"),Promise.resolve([]))}};var v,x;const U={onClicked:((v=e==null?void 0:e.action)==null?void 0:v.onClicked)||((x=e==null?void 0:e.browserAction)==null?void 0:x.onClicked)||null,_raw:(e==null?void 0:e.action)||(e==null?void 0:e.browserAction)||null};(typeof window>"u"||typeof chrome<"u"||typeof browser<"u")&&c();export{k as a,L as b,U as c,C as r,u as s,S as t};
//# sourceMappingURL=browser-api.js.map
