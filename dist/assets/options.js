import"./modulepreload-polyfill.js";import{a as i,j as e,R as Z}from"./common.js";import{D as H}from"./types.js";function K(n){try{let l=n.replace(/^https?:\/\//i,"");return l=l.split("/")[0].split("?")[0].split("#")[0],l=l.split(":")[0],l=l.replace(/^www\./i,""),l=l.trim(),l}catch{return n.replace(/^https?:\/\//i,"").replace(/\/.*$/,"").replace(/\?.*$/,"").replace(/#.*$/,"").replace(/:.*$/,"").replace(/^www\./i,"").trim()}}function E(n,l){if(n.length===0)return{type:"bonusRerolls",bonusRerolls:1};if(Math.random()<.1)return{type:"bonusRerolls",bonusRerolls:1};{const h=Math.floor(Math.random()*n.length),p=n[h],d=l[p]||[];let s;if(d.length>0){const o=Math.floor(Math.random()*d.length);s=d[o]}else s=Math.floor(Math.random()*116)+5;return{type:"domain",domain:p,durationMinutes:s}}}const C="cardGambleRerollState",ee=60,N=3;function te({domains:n,domainDurations:l={},resetKey:b}){const[h,p]=i.useState([]),[d,s]=i.useState(!1),[o,m]=i.useState(null),[f,w]=i.useState(0),[c,j]=i.useState(N),[y,T]=i.useState(null),[A,L]=i.useState(0),[D,Y]=i.useState(!0),[v,R]=i.useState(!1),[M,k]=i.useState(null),[z,I]=i.useState(0),[S,$]=i.useState(null),[_,U]=i.useState([0,0,0]);i.useEffect(()=>{(async()=>{try{const{[C]:t}=await chrome.storage.local.get(C);if(t){const r=t,u=Date.now();if(r.rerollResetTime&&r.rerollResetTime<=u)j(N),T(null),R(!1),m(null),await chrome.storage.local.remove(C);else{if(j(r.availableRerolls??N),T(r.rerollResetTime),r.cards&&r.cards.length>0){if(p(r.cards),m(r.selectedCard??null),R(r.cardsLocked??!1),s(r.showCards??!0),w(r.animationKey??0),r.selectedCardExpiresAt)k(r.selectedCardExpiresAt);else if(r.selectedCard!==null&&r.selectedCard!==void 0){const x=r.cards[r.selectedCard];if(x&&x.type==="domain"&&x.domain)try{const g=await chrome.runtime.sendMessage({action:"getActiveUnblocks"});if(g&&g.success&&g.unblocks){const V=K(x.domain).toLowerCase(),W=g.unblocks.find(X=>K(X.domain).toLowerCase()===V);W&&k(W.expiresAt)}}catch(g){console.error("Error fetching active unblocks on load:",g)}}}if(r.rerollResetTime&&r.rerollResetTime>u&&R(!0),r.rerollResetTime&&r.rerollResetTime>u)try{chrome.runtime.sendMessage({action:"scheduleRerollReset",resetTime:r.rerollResetTime})}catch(x){console.error("Error scheduling reroll reset:",x)}}}}catch(t){console.error("Error loading reroll state:",t)}finally{Y(!1)}})()},[]),i.useEffect(()=>{if(D)return;(async()=>{try{const t={availableRerolls:c,rerollResetTime:y,lastCardGeneration:Date.now(),cards:h,selectedCard:o,cardsLocked:v,showCards:d,animationKey:f,selectedCardExpiresAt:M};await chrome.storage.local.set({[C]:t})}catch(t){console.error("Error saving reroll state:",t)}})()},[c,y,h,o,v,d,f,M,D]),i.useEffect(()=>{if(b===void 0)return;(async()=>{j(N),T(null),R(!1),m(null),L(0),k(null),$(null),await chrome.storage.local.remove(C);try{chrome.runtime.sendMessage({action:"cancelRerollReset"})}catch(t){console.error("Error canceling reroll reset:",t)}if(n.length>0){const t=Array.from({length:3},()=>E(n,l));p(t),U([0,0,0]),w(r=>r+1),s(!1),setTimeout(()=>{s(!0)},50)}})()},[b]),i.useEffect(()=>{if(n.length>0&&!D&&h.length===0){const a=Array.from({length:3},()=>E(n,l));p(a),U([0,0,0]),m(null),s(!1),w(t=>t+1),setTimeout(()=>{s(!0)},50)}},[n,l,D,h.length]),i.useEffect(()=>{if(!y){L(0);return}const a=()=>{const r=Date.now(),u=Math.max(0,y-r);if(L(u),u===0){if(j(N),T(null),R(!1),m(null),k(null),$(null),n.length>0){const x=Array.from({length:3},()=>E(n,l));p(x),w(g=>g+1),s(!1),setTimeout(()=>{s(!0)},50)}chrome.storage.local.remove(C).catch(console.error)}};a();const t=setInterval(a,1e3);return()=>clearInterval(t)},[y,c,n,l]);const P=a=>{c<=0||(U(t=>{const r=[...t];return r[a]=(r[a]||0)+1,r}),setTimeout(()=>{p(t=>{const r=[...t];return r[a]=E(n,l),r})},50),j(t=>t-1))},q=async a=>{if(o!==null||v)return;const t=h[a];if(t){if(t.type==="bonusRerolls"&&t.bonusRerolls){j(r=>r+t.bonusRerolls),p(r=>{const u=[...r];return u[a]=E(n,l),u});return}if(m(a),R(!0),j(0),!y){const r=Date.now()+ee*60*1e3;T(r);try{chrome.runtime.sendMessage({action:"scheduleRerollReset",resetTime:r})}catch(u){console.error("Error scheduling reroll reset:",u)}}if(t.type==="domain"&&t.domain&&t.durationMinutes){const r=Date.now()+t.durationMinutes*60*1e3;k(r);try{await chrome.runtime.sendMessage({action:"temporaryUnblock",domain:t.domain,expiresAt:r,durationMinutes:t.durationMinutes})}catch(u){console.error("Error sending unblock message:",u)}}}};i.useEffect(()=>{if(!M){I(0);return}const a=()=>{const r=Date.now(),u=Math.max(0,M-r);I(u),u===0&&o!==null&&($(o),m(null),k(null),R(!1))};a();const t=setInterval(a,1e3);return()=>clearInterval(t)},[M,o]);const B=a=>{if(a<=0)return"00:00";const t=Math.floor(a/1e3),r=Math.floor(t/60),u=t%60;return`${r.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`},J=a=>{if(a<=0)return"Expired";const t=Math.floor(a/1e3),r=Math.floor(t/3600),u=Math.floor(t%3600/60),x=t%60;return r>0?`${r}:${u.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`:`${u}:${x.toString().padStart(2,"0")}`},Q=async()=>{if(o===null)return;const a=h[o];if(!(!a||a.type!=="domain"||!a.domain))try{await chrome.runtime.sendMessage({action:"cancelTemporaryUnblock",domain:a.domain}),I(0),$(o),m(null),k(null)}catch(t){console.error("Error canceling unblock:",t)}};if(n.length===0)return null;const G=c>0;return e.jsxs("div",{className:"card-gamble-container",children:[e.jsx("h2",{children:"Gamble for Unblock Time"}),e.jsxs("p",{className:"card-gamble-description",children:["Three cards will drop down. Each card can show either a domain with unblock duration or bonus re-roll. Bonus re-roll cards have a 10% chance to appear. You start with ",N," re-roll","s"," and can earn more by selecting bonus re-roll cards. Then select one card."]}),e.jsxs("div",{className:"reroll-counter-container",children:[c>0&&e.jsxs("div",{className:"reroll-counter",children:[e.jsxs("span",{className:"reroll-counter-label",children:["Re-roll",c!==1?"s":""," available:"]}),e.jsx("span",{className:"reroll-counter-value",children:c})]}),c===0&&A>0&&e.jsxs("div",{className:"reroll-timer",children:["Next selection in: ",e.jsx("span",{className:"timer-value",children:B(A)})]})]}),e.jsx("div",{className:"cards-wrapper",children:h.map((a,t)=>e.jsxs("div",{className:"card-wrapper",children:[e.jsxs("div",{className:`gamble-card ${d||_[t]>0?"card-drop":""} ${o===t&&S!==t?"card-clicked":""} ${S===t||o!==t&&(v||S!==null)?"card-disabled":""} ${o===null&&!v&&S===null?"card-clickable":""}`,style:{animationDelay:`${t*.2}s`},onClick:()=>o===null&&!v&&S===null&&q(t),children:[o===t&&S!==t&&e.jsx("div",{className:"card-selected-banner",children:"SELECTED"}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"card-domain",children:a.type==="domain"&&a.domain?K(a.domain):a.type==="bonusRerolls"?"BONUS RE-ROLL":""})}),e.jsx("div",{className:"card-symbol",children:a.type==="domain"?"â±ï¸":"ðŸŽ"}),e.jsxs("div",{className:"card-body",children:[a.type==="domain"&&a.durationMinutes?e.jsxs("div",{className:"card-duration",children:[a.durationMinutes," ",a.durationMinutes===1?"minute":"minutes"]}):a.type==="bonusRerolls"&&a.bonusRerolls?e.jsx("div",{className:"card-bonus-rerolls",children:"+1 re-roll"}):null,o===t&&S!==t&&e.jsx("div",{className:"card-selected-message",children:a.type==="domain"&&a.durationMinutes?e.jsxs("div",{className:"card-selected-content",children:[e.jsxs("div",{className:"card-selected-text",children:["âœ“ Selected! Unblocked for: ",e.jsx("span",{className:"card-countdown",children:J(z)})]}),e.jsx("button",{className:"cancel-unblock-card-button",onClick:r=>{r.stopPropagation(),Q()},title:"Cancel this unblock",children:"Cancel"})]}):a.type==="bonusRerolls"&&a.bonusRerolls?e.jsx(e.Fragment,{children:"âœ“ Bonus applied! You gained 1 re-roll!"}):null}),o===null&&e.jsx("div",{className:"card-actions",children:e.jsx("div",{className:"card-click-hint",children:v?"Waiting for timer to reset...":"Click card to select"})})]})]})]},`${f}-${t}-${_[t]||0}`),o===null&&e.jsx("div",{className:"card-reroll-section",children:e.jsx("button",{onClick:()=>P(t),disabled:!G,className:"reroll-button",title:G?`${c} re-roll${c!==1?"s":""} left`:`No re-roll${c!==1?"s":""} left. Next selection in ${B(A)}`,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),e.jsx("path",{d:"M3 21v-5h5"})]})})})]},`card-wrapper-${f}-${t}`))})]})}function F(n){return n.toLowerCase().replace(/^https?:\/\//i,"").replace(/\/.*$/,"").replace(/^www\./i,"").trim()}function se({settings:n,onSave:l}){const[b,h]=i.useState(""),p=async()=>{const s=b.trim().replace(/^https?:\/\//,"").replace(/\/.*$/,"");if(!s)return;const o=F(s);if(n.blockedHosts.some(w=>F(w)===o))return;const f={...n.domainDurations||{}};f[s]||(f[s]=[]),f[s].includes(10)||f[s].push(10),f[s].sort((w,c)=>w-c),await l({...n,blockedHosts:[...n.blockedHosts,s],domainDurations:f}),h("")},d=async s=>{const o={...n.domainDurations||{}};delete o[s],await l({...n,blockedHosts:n.blockedHosts.filter(m=>m!==s),domainDurations:o})};return e.jsxs("section",{children:[e.jsx("h2",{children:"Blocked sites"}),e.jsxs("div",{className:"row",children:[e.jsx("input",{placeholder:"e.g. twitter.com",value:b,onChange:s=>h(s.target.value)}),e.jsx("button",{onClick:p,children:"Add"})]}),e.jsx("ul",{className:"host-list",children:n.blockedHosts.map(s=>{const o=(n.domainDurations||{})[s]||[];return e.jsxs("li",{className:"host-item",children:[e.jsxs("div",{className:"host-header",children:[e.jsx("span",{className:"host-name",children:s}),e.jsx("button",{onClick:()=>d(s),children:"remove"})]}),e.jsxs("div",{className:"durations-section",children:[e.jsx("label",{className:"durations-label",children:"Unblock durations (minutes):"}),e.jsxs("div",{className:"durations-list",children:[o.map((m,f)=>e.jsxs("span",{className:"duration-tag",children:[m," min",e.jsx("button",{className:"duration-remove",onClick:async()=>{const w={...n.domainDurations||{}};w[s]=o.filter((c,j)=>j!==f),w[s].length===0&&delete w[s],await l({...n,domainDurations:w})},children:"Ã—"})]},f)),e.jsx("input",{type:"number",min:"1",placeholder:"Add duration",className:"duration-input",onKeyDown:async m=>{if(m.key==="Enter"){const f=m.currentTarget,w=parseInt(f.value);if(w>0){const c={...n.domainDurations||{}};c[s]||(c[s]=[]),c[s].includes(w)||(c[s]=[...c[s],w],c[s].sort((j,y)=>j-y),await l({...n,domainDurations:c})),f.value=""}}}})]})]})]},s)})})]})}const ne=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function re({settings:n,onSave:l}){const b=async()=>{const d={day:1,start:"09:00",end:"17:00"};await l({...n,windows:[...n.windows,d]})},h=async(d,s)=>{const o=n.windows.slice();o[d]={...o[d],...s},await l({...n,windows:o})},p=async d=>{const s=n.windows.slice();s.splice(d,1),await l({...n,windows:s})};return e.jsxs("section",{children:[e.jsx("h2",{children:"Time windows"}),e.jsx("button",{onClick:b,children:"Add window"}),n.windows.map((d,s)=>e.jsxs("div",{className:"card",children:[e.jsxs("label",{children:["Day:",e.jsx("select",{value:d.day,onChange:o=>h(s,{day:Number(o.target.value)}),children:ne.map((o,m)=>e.jsx("option",{value:m,children:o},m))})]}),e.jsxs("label",{children:["Start:",e.jsx("input",{type:"time",value:d.start,onChange:o=>h(s,{start:o.target.value})})]}),e.jsxs("label",{children:["End:",e.jsx("input",{type:"time",value:d.end,onChange:o=>h(s,{end:o.target.value})})]}),e.jsx("button",{onClick:()=>p(s),children:"remove"})]},s))]})}function ae({settings:n,onSave:l}){return e.jsxs("section",{children:[e.jsx("h2",{children:"Master switch"}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:n.enabled,onChange:b=>l({...n,enabled:b.target.checked})}),"Enabled"]})]})}function oe({onReset:n}){const l=async()=>{confirm("Reset all settings to defaults? This cannot be undone.")&&(await chrome.storage.sync.remove("settings"),await n())};return e.jsxs("section",{children:[e.jsx("h2",{children:"Reset"}),e.jsx("button",{onClick:l,className:"reset-button",children:"Reset to Defaults"}),e.jsx("p",{className:"reset-description",children:"This will clear all saved settings and restore defaults."})]})}const O="settings";function le(){const[n,l]=i.useState(H),[b,h]=i.useState(0);i.useEffect(()=>{(async()=>{const{[O]:s}=await chrome.storage.sync.get(O);l({...H,...s||{}})})()},[]);const p=async s=>{l(s),await chrome.storage.sync.set({[O]:s})},d=async()=>{l(H),h(s=>s+1);try{await chrome.runtime.sendMessage({action:"clearTemporaryUnblocks"})}catch(s){console.error("Error clearing temporary unblocks:",s)}};return e.jsxs("div",{className:"p",children:[e.jsx("h1",{children:"Blocker Options"}),n.blockedHosts.length>0&&e.jsx("section",{children:e.jsx(te,{domains:n.blockedHosts,domainDurations:n.domainDurations||{},resetKey:b})}),e.jsx(se,{settings:n,onSave:p}),e.jsx(re,{settings:n,onSave:p}),e.jsx(ae,{settings:n,onSave:p}),e.jsx(oe,{onReset:d})]})}Z.createRoot(document.getElementById("root")).render(e.jsx(le,{}));
//# sourceMappingURL=options.js.map
